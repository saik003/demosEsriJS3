<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>


    <meta name="viewport"
          content="initial-scale=1, maximum-scale=1,user-scalable=no">
    <title>Create Map with Custom ArcGISDynamicMapServiceLayer Layer
      Definitions</title>

    <link rel="stylesheet"
          href="https://js.arcgis.com/3.17/esri/css/esri.css"/>
    <style>
      html, body, #mapDiv {
        padding: 0;
        margin: 0;
        height: 100%;
      }

    </style>

    <script src="https://js.arcgis.com/3.17/"></script>
    <script>
      var map;

      require([
        "esri/map",
        "esri/layers/ArcGISDynamicMapServiceLayer",
        "esri/layers/ImageParameters",
        "dojo/domReady!"
      ],
        function (Map, ArcGISDynamicMapServiceLayer, ImageParameters) {

          map = new Map("mapDiv", {
            basemap: "streets",
            center: [-98.258, 38.236],
            zoom: 7
          });
          esri.config.defaults.io.proxyUrl="http://localhost/proxy/ProxyEsri/proxy.ashx"

          //Use the ImageParameters to set map service layer definitions and map service visible layers before adding to the client map.
          var imageParameters = new ImageParameters();

          //ImageParameters.layerDefinitions takes an array.  The index of the array corresponds to the layer id.
          //In the sample below an element is added in the array at 3, 4, and 5 indexes.
          //Those array elements correspond to the layer id within the remote ArcGISDynamicMapServiceLayer
          var layerDefs = [];
          //layerDefs[22] = "SHAPE.Filter('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";
          //layerDefs[46] = "SHAPE.STIntersects(Geometry::STGeomFromText('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";
          //layerDefs[70] = "SHAPE.STIntersects(Geometry::STGeomFromText('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";
          //layerDefs[93] = "SHAPE.STIntersects(Geometry::STGeomFromText('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";
          //layerDefs[104] = "SHAPE.STIntersects(Geometry::STGeomFromText('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";
          //layerDefs[115] = "SHAPE.STIntersects(Geometry::STGeomFromText('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";
          //layerDefs[121] = "SHAPE.STIntersects(Geometry::STGeomFromText('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";
          //layerDefs[127] = "SHAPE.STIntersects(Geometry::STGeomFromText('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";

          layerDefs[22] = "MATERIAL=8 AND SHAPE.Filter('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";
          layerDefs[46] = "MATERIAL=8 AND SHAPE.Filter('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";
          layerDefs[70]= "MATERIAL=8 AND SHAPE.Filter('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";
          layerDefs[93]= "MATERIAL=8 AND SHAPE.Filter('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";
          layerDefs[104]= "MATERIAL=8 AND SHAPE.Filter('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";
          layerDefs[121]= "MATERIAL=8 AND SHAPE.Filter('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";
          layerDefs[115] = "MATERIAL=8 AND SHAPE.Filter('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";
          layerDefs[127] = "MATERIAL=8 AND SHAPE.Filter('POLYGON((-238746.28053435637 4493158.687231494,-238746.28053435637 4493822.733914739,-237721.5466238812 4493822.733914739,-237721.5466238812 4493158.687231494,-238746.28053435637 4493158.687231494))',3857))=1";

          imageParameters.layerDefinitions = layerDefs;

          //I want layers 5,4, and 3 to be visible
          imageParameters.layerIds = [22,46,70,93,104,115,121,127];
          imageParameters.layerOption = ImageParameters.LAYER_OPTION_SHOW;
          imageParameters.transparent = true;

          //construct ArcGISDynamicMapServiceLayer with imageParameters from above
          var dynamicMapServiceLayer = new ArcGISDynamicMapServiceLayer("http://gessergis3:6080/arcgis/rest/services/ALBOX_ABASTECIMIENTO/MapServer",
            {"imageParameters": imageParameters});

          map.addLayer(dynamicMapServiceLayer);
        });
    </script>
  </head>

  <body>
    <div id="mapDiv"></div>
  </body>
</html>
